<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Jenkins</title>
    <link rel="canonical" href="https://docs.jenkins.com/solutions/2.1/php.html">
    <link rel="prev" href="github.html">
    <link rel="next" href="pipeline.html">
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<script type="module" src="https://unpkg.com/@jenkinsci/jenkins-io-components?module"></script>
<jio-navbar style="  position: fixed;
  top: 0;
  width: 100vw;
  z-index: 100;"></jio-navbar><div class="body">
<div class="nav-container" data-component="solutions" data-version="2.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Jenkins Solutions Page</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">index.adoc</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="java.html">java.adoc</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="android.html">android.adoc</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ruby.html">ruby.adoc</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="docker.html">docker.adoc</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="python.html">python.adoc</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="c.html">c.adoc</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="embedded.html">embedded.adoc</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="bitbucketserver.html">Bitbucket Server</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="github.html">github.adoc</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="php.html">php.adoc</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pipeline.html">pipeline.adoc</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Jenkins Solutions Page</span>
    <span class="version">2.1</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../dev-docs/index.html">Jenkins Developer Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../dev-docs/index.html">default</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">Jenkins Solutions Page</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">2.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../tutorial/2.1/index.html">Jenkins Tutorials</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../tutorial/2.1/index.html">2.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../user-docs/2.1/index.html">Jenkins User Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../user-docs/2.1/index.html">2.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../user-docs/2.1/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Jenkins Solutions Page</a></li>
    <li><a href="index.html">index.adoc</a></li>
    <li><a href="php.html">php.adoc</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/Vandit1604/jenkins-docs/edit/main/docs/solutions/modules/ROOT/pages/php.adoc"><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M441 58.9L453.1 71c9.4 9.4 9.4 24.6 0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9 0zM209.8 256.2L344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1l-58.5 16.7 16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25L175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 100c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l100-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7 0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4 0 152V424c0 48.6 39.4 88 88 88H360c48.6 0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1 0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H200c13.3 0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg>  Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<hr>
<div class="paragraph">
<p>layout: solution
title: "Jenkins and PHP"
---</p>
</div>
<div class="paragraph">
<p>Most web applications are changed and adapted quite frequently and quickly.
Their environment, for example the size and the behaviour of the user base, are
constantly changing. What was sufficient yesterday can be insufficient today.
Especially in a web environment it is important to monitor and continuously
improve the internal quality not only when developing, but also when
maintaining the software.</p>
</div>
<div class="paragraph">
<p>This guide provides a basic configuration for testing and reporting for PHP
projects with Jenkins.</p>
</div>
<div class="paragraph">
<p>In addition to running and reporting tests, you&#8217;ll get reports on test run
times, test coverage (including visualizations), and static analysis checks,
including trend graphs, and new and fixed issues compared to the master /
reference branch.</p>
</div>
<div class="paragraph">
<p>Use the <strong>pipeline step reference</strong> link on the plugin pages for full
documentation and options for Jenkinsfile.</p>
</div>
<div class="sect1">
<h2 id="_configuring_php_tools"><a class="anchor" href="#_configuring_php_tools"></a>Configuring PHP Tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide uses Jenkinsfile based pipelines and assumes you already have a
basic Jenkinsfile.</p>
</div>
<div class="paragraph">
<p>This guide assumes that you already have each of the tools mentioned
configured for use outside of Jenkins. Only the necessary configuration
options for working with Jenkins are mentioned.</p>
</div>
<div class="paragraph">
<p>This guide uses the <code>build/</code> directory for storing generated logs and reports.</p>
</div>
<div class="paragraph">
<p>It&#8217;s assumed that all tools configuration files are in the repository root and
PHP code is in the <code>src</code> subdirectory.</p>
</div>
<div class="sect2">
<h3 id="_phpunit_test_coverage_reports"><a class="anchor" href="#_phpunit_test_coverage_reports"></a>PHPUnit Test &amp; Coverage Reports</h3>
<div class="paragraph">
<p>The following configuration will set up 3 reports for PHPUnit tests:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pass/fail monitoring via the plugin:xunit[xUnit plugin]</p>
</li>
<li>
<p>Coverage stats via the plugin:code-coverage-api[Code Coverage API plugin] (using the cobertura adaptor)</p>
</li>
<li>
<p>HTML coverage report via the plugin:htmlpublisher[HTML Publisher plugin]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the PHPUnit config file (<code>phpunit.xml</code> or <code>phpunit.xml.dist</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;phpunit&gt;
    &lt;coverage&gt;
        &lt;include&gt;
            &lt;directory suffix=".php"&gt;src&lt;/directory&gt;
        &lt;/include&gt;
        &lt;report&gt;
            &lt;html outputDirectory="build/coverage" /&gt;
            &lt;cobertura outputFile="build/logs/cobertura.xml"/&gt;
        &lt;/report&gt;
    &lt;/coverage&gt;
    &lt;logging&gt;
        &lt;junit outputFile="build/logs/junit.xml" /&gt;
    &lt;/logging&gt;
&lt;/phpunit&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the Jenkinsfile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">stage('Unit Tests') {
    steps {
        sh 'vendor/bin/phpunit'
        xunit([
            thresholds: [
                failed ( failureThreshold: "0" ),
                skipped ( unstableThreshold: "0" )
            ],
            tools: [
                PHPUnit(pattern: 'build/logs/junit.xml', stopProcessingIfError: true, failIfNotNew: true)
            ]
        ])
        publishHTML([
            allowMissing: false,
            alwaysLinkToLastBuild: false,
            keepAll: false,
            reportDir: 'build/coverage',
            reportFiles: 'index.html',
            reportName: 'Coverage Report (HTML)',
            reportTitles: ''
        ])
        publishCoverage adapters: [coberturaAdapter('build/logs/cobertura.xml')]
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_phpstan_and_codesniffer_static_analysis_reports"><a class="anchor" href="#_phpstan_and_codesniffer_static_analysis_reports"></a>PHPStan and CodeSniffer Static Analysis Reports</h3>
<div class="paragraph">
<p>In this example, PHPCS is shown running with 2 different configurations (mainly
to show this can be done).</p>
</div>
<div class="paragraph">
<p>Reports are processed using the CheckStyle format report and the
plugin:warnings-ng[Warnings Next Generation plugin]</p>
</div>
<div class="paragraph">
<p>This is done because PHPCompatibility checks are run across the <code>vendor/</code>
directory to aid in monitoring potential problems for version updates.</p>
</div>
<div class="paragraph">
<p>This example setup shows running the static analysis tools in parallel, which
may result in faster build times.</p>
</div>
<div class="paragraph">
<p>In Jenkinsfile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">stages {
    stage('Static Analysis') {
        parallel {
          stage('CodeSniffer') {
              steps {
                  sh 'vendor/bin/phpcs --standard=phpcs.xml .'
              }
          }
          stage('PHP Compatibility Checks') {
              steps {
                  sh 'vendor/bin/phpcs --standard=phpcs-compatibility.xml .'
              }
          }
          stage('PHPStan') {
              steps {
                  sh 'vendor/bin/phpstan analyse --error-format=checkstyle --no-progress -n . &gt; build/logs/phpstan.checkstyle.xml'
              }
          }
        }
    }
    post {
        always {
            recordIssues([
                sourceCodeEncoding: 'UTF-8',
                enabledForFailure: true,
                aggregatingResults: true,
                blameDisabled: true,
                referenceJobName: "repo-name/master",
                tools: [
                    phpCodeSniffer(id: 'phpcs', name: 'CodeSniffer', pattern: 'build/logs/phpcs.checkstyle.xml', reportEncoding: 'UTF-8'),
                    phpStan(id: 'phpstan', name: 'PHPStan', pattern: 'build/logs/phpstan.checkstyle.xml', reportEncoding: 'UTF-8'),
                    phpCodeSniffer(id: 'phpcompat', name: 'PHP Compatibility', pattern: 'build/logs/phpcs-compat.checkstyle.xml', reportEncoding: 'UTF-8')
                ]
            ])
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll want to change the <code>repo-name</code> in the <code>referenceJobName</code> directive to
match your repository. This tells Jenkins which job to compare the results
against for branches and PR jobs.</p>
</div>
<div class="paragraph">
<p>Set the report location in CodeSniffers configuration file (<code>phpcs.xml</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ruleset name="Default"&gt;
    &lt;arg name="report-checkstyle" value="build/logs/phpcs.checkstyle.xml" /&gt;
&lt;/ruleset&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_ignoring_tool_run_failures_tuning_failure_conditions"><a class="anchor" href="#_ignoring_tool_run_failures_tuning_failure_conditions"></a>Ignoring tool run failures / tuning failure conditions</h4>
<div class="paragraph">
<p>If you want the build to pass regardless of the results of tools (ie. ignore
the exit code), you can append <code>|| exit 0</code> to the end of the <code>sh</code> command.</p>
</div>
<div class="paragraph">
<p>Alternatively, for CodeSniffer you can add the following into the configuration
file (<code>phpcs.xml</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ruleset name="default"&gt;
    &lt;config name="ignore_errors_on_exit" value="1" /&gt;
    &lt;config name="ignore_warnings_on_exit" value="1" /&gt;
&lt;/ruleset&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then fine-tune the failure conditions using the
<a href="/doc/pipeline/steps/warnings-ng/">Warnings-NG pipeline configuration</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_results_caching"><a class="anchor" href="#_results_caching"></a>Results Caching</h4>
<div class="paragraph">
<p>You can improve build times (for each run after the first) using caching
features available in both CodeSniffer and PHPStan.</p>
</div>
<div class="paragraph">
<p>In CodeSniffers configuration file (<code>phpcs.xml</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ruleset name="default"&gt;
    &lt;arg name="cache" value="build/cache/codesniffer.phpcs" /&gt;
&lt;/ruleset&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have multiple CodeSniffer configurations as in the example Jenkinsfile
above, be sure to set different cache paths.</p>
</div>
<div class="paragraph">
<p>In PHPStan&#8217;s configuration file (<code>phpstan.neon</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">parameters:
    tmpDir: build/cache/phpstan</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="github.html">github.adoc</a></span>
  <span class="next"><a href="pipeline.html">pipeline.adoc</a></span>
</nav>
</article>
  </div>
</main>
</div>
<jio-footer></jio-footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
